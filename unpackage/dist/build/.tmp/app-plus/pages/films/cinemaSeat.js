(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/films/cinemaSeat"],{1639:function(e,t,n){"use strict";var s=n("c387"),i=n.n(s);i.a},4371:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(n("a34a")),i=n("14dc"),a=n("6300"),o=n("1c23"),l=n("1264"),c=n("29cc");function r(e){return e&&e.__esModule?e:{default:e}}function f(e,t,n,s,i,a,o){try{var l=e[a](o),c=l.value}catch(r){return void n(r)}l.done?t(c):Promise.resolve(c).then(s,i)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(s,i){var a=e.apply(t,n);function o(e){f(a,s,i,o,l,"next",e)}function l(e){f(a,s,i,o,l,"throw",e)}o(void 0)})}}var m=function(){return n.e("components/t-table/t-table").then(n.bind(null,"2000"))},d=function(){return n.e("components/t-table/t-th").then(n.bind(null,"a5e7"))},g=function(){return n.e("components/t-table/t-tr").then(n.bind(null,"494c"))},h=function(){return n.e("components/t-table/t-td").then(n.bind(null,"d239"))},S={data:function(){return{sessionId:"",cinemaId:"",cinema:{},filmId:"",film:{},session:{},checked:!1,seats:[],money:"",hallId:"",hall:{},seatInfo:[[]],otherSeats:[],mySeats:[],userInfo:{},currentDate:""}},components:{tTable:m,tTh:d,tTr:g,tTd:h},onLoad:function(t){var n=this;u(s.default.mark(function i(){return s.default.wrap(function(s){while(1)switch(s.prev=s.next){case 0:console.log("option"+JSON.stringify(t)," at pages\\films\\cinemaSeat.vue:105"),n.sessionId=t.sessionId,n.filmId=t.filmId,n.cinemaId=t.cinemaId,n.hallId=t.hallId,n.currentDate=t.date,n.getSessionDeatil(),n.findOtherSeat(),n.seats=[],n.userInfo=e.getStorageSync("userinfo"),console.log("this.userInfo: "+JSON.stringify(n.userInfo)," at pages\\films\\cinemaSeat.vue:115"),n.findMySeat();case 12:case"end":return s.stop()}},i,this)}))()},onShow:function(){},methods:{getSessionDeatil:function(){var e=this,t={sessionId:this.sessionId};(0,i.findSessionById)(t).then(function(t){if(0===t.errno){e.session=t.data;var n=e.session.playTime.split(" ");e.session.playTime=n[n.length-1];var s=e.session.endTime.split(" ");e.session.endTime=s[s.length-1]}},function(e){console.log("err"+JSON.stringify(e)," at pages\\films\\cinemaSeat.vue:142")}),(0,a.findCinemaById)({id:this.cinemaId}).then(function(t){0===t.errno&&(e.cinema=t.data)},function(e){console.log("err1"+JSON.stringify(e)," at pages\\films\\cinemaSeat.vue:153")}),(0,o.findFilmById)({id:this.filmId}).then(function(t){0===t.errno&&(e.film=t.data,0===e.film.dimensional?e.film.dimensional="3D":e.film.dimensional="2D")},function(e){console.log("err2"+JSON.stringify(e)," at pages\\films\\cinemaSeat.vue:169")}),(0,l.findHallById)({id:this.hallId}).then(function(t){if(console.log("res3"+JSON.stringify(t)," at pages\\films\\cinemaSeat.vue:175"),0===t.errno){e.hall=t.data,console.log("this.hall.row"+JSON.stringify(e.hall.row)," at pages\\films\\cinemaSeat.vue:179"),console.log("this.hall.coloum"+JSON.stringify(e.hall.column)," at pages\\films\\cinemaSeat.vue:180");for(var n=1;n<=e.hall.row;n++){e.seatInfo[n-1]=[];for(var s=1;s<=e.hall.column;s++)e.seatInfo[n-1][s-1]="../../static/noseat.png"}}},function(e){console.log("err3"+JSON.stringify(e)," at pages\\films\\cinemaSeat.vue:193")})},findOtherSeat:function(){var e=this;(0,c.findTicketRecordBySessionOrUser)({sessionId:this.sessionId}).then(function(t){0===t.errno&&(console.log("res4"+JSON.stringify(t.data)," at pages\\films\\cinemaSeat.vue:201"),0!==t.data.length&&(e.otherSeats=t.data,console.log("this.seatInfo"+JSON.stringify(e.seatInfo)," at pages\\films\\cinemaSeat.vue:204"),e.otherSeats.forEach(function(t){0!==t.seats.length&&t.seats.forEach(function(n){console.log("other",JSON.stringify(n)," at pages\\films\\cinemaSeat.vue:208"),t.userId!==e.userInfo._id&&(e.seatInfo[n.row-1][n.coloum-1]="../../static/otherseat.png"),console.log("this.seatInfo[item1.row - 1][item1.coloum - 1]",JSON.stringify(e.seatInfo[n.row-1][n.coloum-1])," at pages\\films\\cinemaSeat.vue:212")})})))},function(e){console.log("err4"+JSON.stringify(e)," at pages\\films\\cinemaSeat.vue:220")})},findMySeat:function(){var e=this;(0,c.findTicketRecordBySessionOrUser)({userId:this.userInfo._id}).then(function(t){console.log("this.userInfo._id: "+JSON.stringify(e.userInfo._id)," at pages\\films\\cinemaSeat.vue:227"),0===t.errno&&(console.log("res5"+JSON.stringify(t)," at pages\\films\\cinemaSeat.vue:229"),0!==t.data.length&&(e.mySeats=t.data,console.log("this.seatInfo"+JSON.stringify(e.seatInfo)," at pages\\films\\cinemaSeat.vue:232"),e.mySeats.forEach(function(t){0!==t.seats.length&&t.seats.forEach(function(n){console.log("item1",JSON.stringify(n)," at pages\\films\\cinemaSeat.vue:236"),e.userInfo._id===t.userId&&(e.seatInfo[n.row-1][n.coloum-1]="../../static/myseat.png")})})))},function(e){console.log("err5"+JSON.stringify(e)," at pages\\films\\cinemaSeat.vue:247")})},chooseSeat:function(e){var t=this;console.log("checked"+JSON.stringify(this.checked)," at pages\\films\\cinemaSeat.vue:253"),console.log("e1"+JSON.stringify(e)," at pages\\films\\cinemaSeat.vue:254");var n={row:e[0],coloum:e[1]};"../../static/myseat.png"===this.seatInfo[e[0]-1][e[1]-1]?(console.log("888888888888888888888"," at pages\\films\\cinemaSeat.vue:260"),this.seatInfo[e[0]-1][e[1]-1]="../../static/noseat.png",this.seats.forEach(function(e,s){e.row===n.row&&e.coloum===n.coloum&&(console.log("index"+JSON.stringify(s)," at pages\\films\\cinemaSeat.vue:264"),t.seats.splice(s,1))}),console.log("this.seats"+JSON.stringify(this.seats)," at pages\\films\\cinemaSeat.vue:268")):this.seats.length<=6&&"../../static/myseat.png"!==this.seatInfo[e[0]-1][e[1]-1]?(this.seats.push(n),this.seatInfo[e[0]-1][e[1]-1]="../../static/myseat.png"):this.seats.length>7&&console.log("一次最多只能选7个"," at pages\\films\\cinemaSeat.vue:275"),this.money=parseFloat(this.session.price)*this.seats.length},confirmSeat:function(){if(console.log("userinfo"+JSON.stringify(this.userInfo)," at pages\\films\\cinemaSeat.vue:281"),this.userInfo){console.log("前往支付"," at pages\\films\\cinemaSeat.vue:283");var t={sessionId:this.sessionId,userId:this.userInfo._id,seats:this.seats,allPrice:this.money,status:0};(0,c.addTicketRecord)(t).then(function(t){0===t.errno&&(console.log("res.data"+JSON.stringify(t.data)," at pages\\films\\cinemaSeat.vue:293"),e.navigateTo({url:"./comPay?ticketRecordId="+t.data._id}))})}else console.log("还未登录"," at pages\\films\\cinemaSeat.vue:301"),e.switchTab({url:"../my/index"})}}};t.default=S}).call(this,n("6e42")["default"])},"4f9d":function(e,t,n){"use strict";n.r(t);var s=n("71e1"),i=n("a868");for(var a in i)"default"!==a&&function(e){n.d(t,e,function(){return i[e]})}(a);n("1639");var o=n("2877"),l=Object(o["a"])(i["default"],s["a"],s["b"],!1,null,null,null);t["default"]=l.exports},"71e1":function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement;e._self._c},i=[];n.d(t,"a",function(){return s}),n.d(t,"b",function(){return i})},a868:function(e,t,n){"use strict";n.r(t);var s=n("4371"),i=n.n(s);for(var a in s)"default"!==a&&function(e){n.d(t,e,function(){return s[e]})}(a);t["default"]=i.a},c387:function(e,t,n){}},[["608d","common/runtime","common/vendor"]]]);